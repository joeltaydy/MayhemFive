{% extends 'Module_TeamManagement/Instructor/instructorBase.html' %}
{% load staticfiles %}
{% block bootstrapContent %}

<div class="content">
    <div class="container-fluid">
        <h1 style="text-align: center"> Telegram Management </h1>
        <div class="navDiv text-center" style="display: block;margin-left: auto;margin-right: auto;">
            {% for course_section in course_sectionList %}
                {% if course_section.section_number != 'G0' %}
                    <a href="/instructor/TelegramManagement?course_section={{ course_section.id }}" role="button" class="btn btn-dark">{{ course_section.section_number }}</a>
                {% endif %}
            {% endfor %}
        </div>
        <br>
        {% if current_course_section_details.section_number == 'G0' %}
            <h2 style = "background-color:#23272b; color:white; text-align: center">{{ current_course_section_details.course_title }}</h2>
        {% else %}
            <h2 style = "background-color:#23272b; color:white; text-align: center"> {{ current_course_section_details.course_title  }} {{ current_course_section_details.section_number }}</h2>
        {% endif %}



    </div>

    <br>
    <!-- if no channel/group registered-->
    {% if telegram_chats|length == 0 %}
        <div class="col-md-9" style="display: block;margin-left: auto;margin-right: auto;">
            <div class="card ">
                <div class="card-header" style="display: block;margin-left: auto;margin-right: auto;">
                    <img src="{% static 'images/Telegram Logo.png' %}" alt="..." width=150px height = 150px style="display: block;margin-left: auto;margin-right: auto;" >
                    <br>
                    <div style = "display: block;margin-left: auto;margin-right: auto;"> <h3 align = "center">Oops! <br> You have not configured any groups/channels </h3></div>
                    <br>
                </div>
                <div class="card-body">
                    <div class="btn-group col-md-8 text-center" style="display: block;margin-left: auto;margin-right: auto;margin-bottom: 10px">
                        <button type="button" class="btn" style="background-color: #0088CC;" data-toggle="modal" data-target="#createGroup" value="createGroup">
                            <b>Create Section<br> Group</b>
                        </button>
                        <button type="button" class="btn" style="background-color: #0088CC;" data-toggle="modal" data-target="#createChannel" value="createChannel">
                            <b>Create Section<br> Channel</b>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <!--if channel/group registered-->
    {% else %}
        <div class="col-md-9" style="display: block;margin-left: auto;margin-right: auto;">
            <div class="card ">
                <div class="card-header">
                        <div class="navDiv" style="display: block;margin-left: auto;margin-right: auto;">
                            {% for telegram_chat in telegram_chats %}
                                <a href="/instructor/TelegramManagement?course_section={{ current_course_section_details.id }}&chat_name={{ telegram_chat.name }}" role="button" class="btn btn-dark"  style="background-color: #0088CC;">{{ telegram_chat.name }}</a>
                            {% endfor %}
                        </div>

                        <img src="{% static 'images/Telegram Logo.png' %}" alt="..." width=100px height = 100px style="display: block;margin-left: auto;margin-right: auto;" >
                        <br>
                        <h4 class="text-center">
                            <a href="{{ current_telegram_chat.link }} " role="button" class="btn"  style="background-color: #0088CC;"> <b>{{current_telegram_chat.type}} Link</b></a>
                        </h4>
                    <br>

                    <div class="col-md-12">
                    <div class ="row">
                    <div class = "col-md-6">
                    <div class ="card">
                        <div class="card-header">
                                <h3 class="card-title bg-dark text-white text-center" style="margin-bottom:15px;"><b>Send a Message:</b></h3>
                            <p class="card-category text-center">This message will be sent to your telegram group/channel</p>
                        </div>
                        <div class="card-body">
                            <form action="{% url 'TMmod:faculty_telegram_SendMessage' %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
                                {% csrf_token %}
                                <div class="form-group">
                                    <textarea class="form-control col-md9" style="height:200px; margin-bottom:15px" name="message" id="message"></textarea>
                                    <input type="hidden" name="course_section" id="course_section" value={{current_course_section_details.id}}>
                                    <input type="hidden" name="telegram_chat_name" id="telegram_chat_name" value={{current_telegram_chat.name}}>
                                <!-- Submission -->
                                    <div class="btn-group col-md-8 text-center" style="display: block;margin-left: auto;margin-right: auto;margin-bottom: 10px">
                                        <button class="btn" style = "background-color:#f9b902"><b>Send Message</b></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    </div>
                    <div class = "col-md-6">
                    <div class ="card">
                        <div class="card-header">
                                <h3 class="card-title bg-dark text-white text-center" style="margin-bottom:15px"><b>Registered Members:</b></h3>
                        </div>
                        <div class="card-body">
                            <h3 class="text-center"><b>{{current_telegram_chat.members_count}}</b></h3>
                        </div>
                        <div class="text-center" style ="margin-left:15px; margin-right:15px;">
                            {% include "Module_TeamManagement/Datatables/telegramMembers_table.html" %}
                        </div>
                    </div>
                    </div>

                    </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

<!--Modals for creating group & channel-->

<!--Create Telegram Group-->
<div class="modal fade" id="createGroup">
    <div class="modal-dialog modal-md">
    <div class="modal-content">

        <div class="modal-header text-center">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <div class="modal-body text-center">
            <!--Form Create Group-->

            <img src="{% static 'images/Telegram Logo.png' %}" width=100px height = 100px class="text-center">
            <h4 class="modal-title" >Create Section Group</h4>

            <form action="{% url 'TMmod:faculty_telegram_CreateGroup' %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
                {% csrf_token %}
                <div class="form-group">
                    <label for="name" class="control-label">Please Specify Group Name</label>
                    <input type="text" class="form-control text-center col-md9" name="group_name" id="group_name" placeholder="Group Name">
                    <input type="hidden" name="course_section" id="course_section" value={{current_course_section_details.id}}>
                </div>
                <!-- Submission -->
                <div class="btn-group col-md-8 text-center" style="display: block;margin-left: auto;margin-right: auto;margin-bottom: 10px">
                    <button class="btn btn-dark">Submit</button>
                </div>
            </form>
        </div>
    </div>
    </div>
</div>

<!--Create Telegram Channel-->
<div class="modal fade" id="createChannel">
    <div class="modal-dialog modal-md">
    <div class="modal-content">

        <div class="modal-header text-center">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <div class="modal-body text-center">
            <!--Form Create Channel-->

            <img src="{% static 'images/Telegram Logo.png' %}" width=100px height = 100px class="text-center">
            <h4 class="modal-title" >Create Section Channel</h4>

            <form action="{% url 'TMmod:faculty_telegram_CreateChannel' %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
                {% csrf_token %}
                <div class="form-group">
                    <label for="name" class="control-label">Please Specify Group Name</label>
                    <input type="text" class="form-control text-center col-md9" name="channel_name" id="channel_name" placeholder="Channel Name">
                    <input type="hidden" name="course_section" id="course_section" value={{current_course_section_details.id}}>
                </div>
                <!-- Submission -->
                <div class="btn-group col-md-8 text-center" style="display: block;margin-left: auto;margin-right: auto;margin-bottom: 10px">
                    <button class="btn btn-dark">Submit</button>
                </div>
            </form>
        </div>
    </div>
    </div>
</div>


<script>
    // Add active class to the current button (highlight it)
    $(function(){
        pageUrl = location.href;
        // console.log(pageUrl)
        $('.navDiv a').each(function () {
            link = $(this);
            var href = link.attr("href");
            console.log(link);
            // console.log(link.attr("href") === pageUrl);
            if (href === pageUrl.substring(pageUrl.length-href.length)) {
                console.log("success");
                link.addClass("active");
            }
        });
    });
</script>
{% endblock %}
